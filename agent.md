# Agent Instructions for gdpr-preferenc

Short goal

- Make small, safe changes to this Dockerized Vite+Vue frontend and the demo Node API that demonstrates GDPR operations on user data. Keep edits minimal and low-risk unless the user explicitly asks for larger changes.

Primary files to read first (in order)

- `README.md` — project overview, GDPR intent, and curl examples (single best place to start).
- `docker-compose.yml` and `Makefile` — how maintainers run the project locally (use Compose / Make).
- `server/index.js` — API surface and storage model (demo JSON-file storage; not production-ready).
- `src/App.vue`, `index.html`, `src/main.js` — front-end usage of the API and UI flows.

What the project uses

- Frontend: Vite + Vue (in `src/`).
- API: Node.js demo server under `server/` that persists to `server/db.json` and keeps an append-only `server/audit.log` (for demos only).
- Local development is Docker-first. Prefer running commands inside the containers to match CI.

Quick commands (run these from the repository root)

# (Make/Compose examples; run in a shell inside the project root)
- Start dev (build & start compose):
  - `make dev` or `docker compose up --build`  
- View logs:
  - `make logs` or `docker compose logs -f`  
- Stop:
  - `make down` or `docker compose down`  
- Run tests inside containers (if present):
  - `docker compose exec web npm test`
- Run migrations (if present):
  - `docker compose exec web ./scripts/migrate.sh`

Important GDPR semantics enforced by the demo API

- Consent required at record creation (`POST /users` with `consent: true`).
- Data export: `GET /users/:id/export` returns a JSON export of personal data.
- Deletion: `DELETE /users/:id` performs physical deletion from the demo DB.

API curl examples (useful for quick tests)

- Create user (consent required):
  - `curl -X POST http://localhost:4000/users -H 'Content-Type: application/json' -d '{"email":"alice@example.com","consent":true}'`
- List users:
  - `curl http://localhost:4000/users`
- Export user:
  - `curl http://localhost:4000/users/<id>/export`
- Delete user:
  - `curl -X DELETE http://localhost:4000/users/<id>`

Safe small changes the agent can do without asking

- Add a small unit/integration smoke test that hits `GET /health`, `POST /users`, and `DELETE /users/:id` using the test runner inside the API container.
- Replace the demo JSON storage with `better-sqlite3` and provide a minimal migration script while keeping the same API shape. Add a migration command to `scripts/migrate.sh`.
- Add a GitHub Actions workflow that builds both images and runs the smoke tests.

When to ask a human (required clarifications)

- If changing long-term persistence (which database to use, migration policy).
- If adding authentication: ask whether to implement service-to-service auth (mTLS/JWT) or end-user auth (JWT/password/OAuth).
- If a requested change alters consent semantics (do not change consent requirement without explicit approval).

Edits to avoid unless requested

- Do not change the consent semantics (creation requires explicit consent) without explicit direction.
- Do not replace production-grade security with insecure shortcuts — prefer leaving TODOs and a migration plan.

Where to add changes

- Frontend: `src/` — UI behavior and API calls.
- API: `server/` — business logic, storage, and migrations.
- Orchestration and developer scripts: `docker-compose.yml`, `Makefile`, and `scripts/`.

Quality gates and verification

- After substantive changes, run build/tests/lint where available. Prefer running inside containers to match the developer workflow.
- Quick verification steps to run locally (recommended):
  - `make dev` to start services, then run smoke tests or curl examples above.

Small proactive improvements to suggest (optional)

- Add a lightweight smoke test suite and a `make test` or CI step that runs it.
- Add a migration story (e.g., SQLite via `better-sqlite3`) if persistent storage is needed for demos.

Notes / assumptions

- This repo uses demo JSON storage under `server/db.json` for simplicity. Any persistent storage changes must include a migration plan.
- The agent should follow the repo conventions and prefer minimal, reversible edits.

If you want me to continue

- Say `add tests` to scaffold simple smoke tests.
- Say `add sqlite` to scaffold a SQLite migration and update `scripts/migrate.sh`.

(Generated by the repository helper agent.)

